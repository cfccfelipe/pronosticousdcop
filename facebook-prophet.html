<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capitulo 9 Facebook Prophet | Pronóstico USD/COP</title>
  <meta name="description" content="Análisis y pronóstico a la serie temporal del par de divisas Dolar Americano (USD) con Peso Colombiano (COP)" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Capitulo 9 Facebook Prophet | Pronóstico USD/COP" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Análisis y pronóstico a la serie temporal del par de divisas Dolar Americano (USD) con Peso Colombiano (COP)" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capitulo 9 Facebook Prophet | Pronóstico USD/COP" />
  
  <meta name="twitter:description" content="Análisis y pronóstico a la serie temporal del par de divisas Dolar Americano (USD) con Peso Colombiano (COP)" />
  

<meta name="author" content="Carlos Felipe Cortés Cataño - Roy Díaz Vega" />


<meta name="date" content="2023-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metodología-box-jenkins.html"/>
<link rel="next" href="elman.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Pronostico USD/COP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Fuente de información</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introducción</a></li>
<li class="chapter" data-level="3" data-path="get.html"><a href="get.html"><i class="fa fa-check"></i><b>3</b> Obtención de datos</a></li>
<li class="chapter" data-level="4" data-path="preliminar.html"><a href="preliminar.html"><i class="fa fa-check"></i><b>4</b> Analisis Preliminar</a></li>
<li class="chapter" data-level="5" data-path="ma.html"><a href="ma.html"><i class="fa fa-check"></i><b>5</b> Medias Moviles</a></li>
<li class="chapter" data-level="6" data-path="desco.html"><a href="desco.html"><i class="fa fa-check"></i><b>6</b> Descomposición</a></li>
<li class="chapter" data-level="7" data-path="metodo-holt-winter-hw.html"><a href="metodo-holt-winter-hw.html"><i class="fa fa-check"></i><b>7</b> Metodo Holt-Winter {#h&amp;w}</a></li>
<li class="chapter" data-level="8" data-path="metodología-box-jenkins.html"><a href="metodología-box-jenkins.html"><i class="fa fa-check"></i><b>8</b> Metodología Box-Jenkins</a></li>
<li class="chapter" data-level="9" data-path="facebook-prophet.html"><a href="facebook-prophet.html"><i class="fa fa-check"></i><b>9</b> Facebook Prophet</a></li>
<li class="chapter" data-level="10" data-path="elman.html"><a href="elman.html"><i class="fa fa-check"></i><b>10</b> Red Neuronal Recurrente-ELMAN</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Pronóstico USD/COP</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="facebook-prophet" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Capitulo 9</span> Facebook Prophet<a href="facebook-prophet.html#facebook-prophet" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Paso 0: Preparar los datos para que los reciba Prophet, la fecha debe ser nombrada ds y nuestra variable objetivo y o precio de cierre. Sin diferenciar</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="facebook-prophet.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-2"><a href="facebook-prophet.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophet <span class="im">import</span> Prophet</span>
<span id="cb63-3"><a href="facebook-prophet.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophet.diagnostics <span class="im">import</span> cross_validation</span>
<span id="cb63-4"><a href="facebook-prophet.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophet.diagnostics <span class="im">import</span> performance_metrics</span>
<span id="cb63-5"><a href="facebook-prophet.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="facebook-prophet.html#cb63-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> data.reset_index().rename(columns<span class="op">=</span>{<span class="st">&#39;Date&#39;</span>: <span class="st">&#39;ds&#39;</span>, <span class="st">&#39;Close&#39;</span>: <span class="st">&#39;y&#39;</span>})[[<span class="st">&quot;ds&quot;</span>, <span class="st">&quot;y&quot;</span>]]</span>
<span id="cb63-7"><a href="facebook-prophet.html#cb63-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;ds&#39;</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">&#39;ds&#39;</span>])</span>
<span id="cb63-8"><a href="facebook-prophet.html#cb63-8" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<pre><code>##           ds            y
## 0 2017-01-02  2957.100098
## 1 2017-01-03  2950.699951
## 2 2017-01-04  2916.199951
## 3 2017-01-05  2891.100098
## 4 2017-01-06  2897.899902</code></pre>
<p>Paso 1: Creamos el modelo Prophet. No especificaremos los puntos de cambios, que el mismo algortimo los determine. Hemos visto que nuestro modelo es aditivo. No tenemos estacionalidad diaria, ni semanal evidente por lo tanto no colocaremos los parametros como True.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="facebook-prophet.html#cb65-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Prophet(seasonality_mode<span class="op">=</span><span class="st">&quot;additive&quot;</span>)</span>
<span id="cb65-2"><a href="facebook-prophet.html#cb65-2" aria-hidden="true" tabindex="-1"></a>model.fit(df)</span></code></pre></div>
<pre><code>## &lt;prophet.forecaster.Prophet object at 0x000002733F8FA370&gt;
## 
## 19:48:53 - cmdstanpy - INFO - Chain [1] start processing
## 19:48:54 - cmdstanpy - INFO - Chain [1] done processing</code></pre>
<p>Paso 2: Creamos los 15 siguientes dias que hemos estado pronosticando</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="facebook-prophet.html#cb67-1" aria-hidden="true" tabindex="-1"></a>future <span class="op">=</span> model.make_future_dataframe(periods<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb67-2"><a href="facebook-prophet.html#cb67-2" aria-hidden="true" tabindex="-1"></a>future</span></code></pre></div>
<pre><code>##              ds
## 0    2017-01-02
## 1    2017-01-03
## 2    2017-01-04
## 3    2017-01-05
## 4    2017-01-06
## ...         ...
## 1574 2023-01-10
## 1575 2023-01-11
## 1576 2023-01-12
## 1577 2023-01-13
## 1578 2023-01-14
## 
## [1579 rows x 1 columns]</code></pre>
<p>Paso 3: Pronosticamos y graficamos</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="facebook-prophet.html#cb69-1" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> model.predict(future)</span>
<span id="cb69-2"><a href="facebook-prophet.html#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="facebook-prophet.html#cb69-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> model.plot(forecast)</span>
<span id="cb69-4"><a href="facebook-prophet.html#cb69-4" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-24-19.png" width="960" />
La mayoría de predicciones(linea) adoptan la forma de los datos reales(puntos) o se acojen al intervalo de confianza. Revisemos en un ultimo paso el RMSE usando validación cruzada, donde se hará una división del conjunto de datos de 180 y se evaluaran 90.</p>
<p>Paso 4: Realizamos validación cruzada y calculamos metricas</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="facebook-prophet.html#cb70-1" aria-hidden="true" tabindex="-1"></a>df_cv <span class="op">=</span> cross_validation(model, horizon<span class="op">=</span><span class="st">&quot;90 days&quot;</span>, period <span class="op">=</span> <span class="st">&quot;180 days&quot;</span>)</span></code></pre></div>
<pre><code>## 
  0%|          | 0/10 [00:00&lt;?, ?it/s]19:49:00 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:00 - cmdstanpy - INFO - Chain [1] done processing
## 
 10%|#         | 1/10 [00:00&lt;00:04,  1.87it/s]19:49:01 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:01 - cmdstanpy - INFO - Chain [1] done processing
## 
 20%|##        | 2/10 [00:01&lt;00:04,  1.77it/s]19:49:01 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:02 - cmdstanpy - INFO - Chain [1] done processing
## 
 30%|###       | 3/10 [00:02&lt;00:05,  1.38it/s]19:49:02 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:03 - cmdstanpy - INFO - Chain [1] done processing
## 
 40%|####      | 4/10 [00:02&lt;00:04,  1.28it/s]19:49:03 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:04 - cmdstanpy - INFO - Chain [1] done processing
## 
 50%|#####     | 5/10 [00:04&lt;00:04,  1.04it/s]19:49:04 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:05 - cmdstanpy - INFO - Chain [1] done processing
## 
 60%|######    | 6/10 [00:05&lt;00:04,  1.07s/it]19:49:06 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:06 - cmdstanpy - INFO - Chain [1] done processing
## 
 70%|#######   | 7/10 [00:06&lt;00:03,  1.12s/it]19:49:07 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:07 - cmdstanpy - INFO - Chain [1] done processing
## 
 80%|########  | 8/10 [00:07&lt;00:02,  1.05s/it]19:49:08 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:09 - cmdstanpy - INFO - Chain [1] done processing
## 
 90%|######### | 9/10 [00:09&lt;00:01,  1.28s/it]19:49:10 - cmdstanpy - INFO - Chain [1] start processing
## 19:49:11 - cmdstanpy - INFO - Chain [1] done processing
## 
100%|##########| 10/10 [00:11&lt;00:00,  1.40s/it]
100%|##########| 10/10 [00:11&lt;00:00,  1.10s/it]</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="facebook-prophet.html#cb72-1" aria-hidden="true" tabindex="-1"></a>df_p <span class="op">=</span> performance_metrics(df_cv, rolling_window<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb72-2"><a href="facebook-prophet.html#cb72-2" aria-hidden="true" tabindex="-1"></a>rmses <span class="op">=</span> []  <span class="co"># Store the RMSEs for each params here</span></span>
<span id="cb72-3"><a href="facebook-prophet.html#cb72-3" aria-hidden="true" tabindex="-1"></a>rmses.append(df_p[<span class="st">&#39;rmse&#39;</span>].values[<span class="dv">0</span>])</span>
<span id="cb72-4"><a href="facebook-prophet.html#cb72-4" aria-hidden="true" tabindex="-1"></a>rmses</span></code></pre></div>
<pre><code>## [285.46326653247286]</code></pre>
<p>Este sería el error cuadratrico medio</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="metodología-box-jenkins.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="elman.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-Prophet.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
